<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
</head>
<body>
<h1 id="como-desplegar-una-aplicación-web-en-iaas.ull.es">Como Desplegar una Aplicación Web en <a href="iaas.ull.es" class="uri">iaas.ull.es</a></h1>
<p>Para acceder al servicio, todos los usuarios (tanto los responsables como los usuarios finales) accederán a <a href="">https://iaas.ull.es</a>, donde seleccionarán la opción <strong>Portal del usuario</strong>.</p>
<p>Serán requeridas las credenciales de la ULL; es decir, este servicio será exclusivo para la comunidad universitaria</p>
<ul>
<li><p>Véase <a href="https://sytw.github.io/iaas-ull-es/index.html">este documento como HTML</a></p></li>
<li><p>Véase este <a href="https://github.com/SYTW/iaas-ull-es">repo en GitHub</a></p></li>
<li><p>Lea el documento <a href="manualDeAdministracionDelPoolsDeMaquinas.pdf">&quot;Manual de administración de Pools de máquinas&quot;</a>.</p></li>
<li><p>En principio se dispone de una máquina por alumno</p></li>
<li><p>Se han configurado con el visor VNC (recuerde poner la opción <code>noVNC</code> en las opciones de la cónsola)</p></li>
</ul>
<div class="figure">
<img src="novncconsoleoptions.png" alt="Opciones de la Consola" /><p class="caption">Opciones de la Consola</p>
</div>
<ul>
<li><p>Las máquinas comparten el &quot;tag&quot; <code>SISTECWEB</code> para identificarlas</p></li>
<li><p>Las máquinas tienen 2GB de RAM y 1 procesador de 2 CPUs cada una</p></li>
<li><p>Está instalado <code>git</code>, una versión de <code>node</code></p>
<pre><code>          usuario@SYTW:~$ git --version
          git version 1.9.1</code></pre></li>
</ul>
<p>Si queremos actualizar <code>git</code>:</p>
<pre class="sh"><code>apt-get install git</code></pre>
<ul>
<li><p>Está instalado <code>nodejs</code>. Recuerde que es Linux Ubuntu: <code>node</code> no es <code>nodejs</code>:</p>
<pre><code>    usuario@SYTW:~$ node --version
    El programa «node» puede encontrarse en los siguientes paquetes:
     * node
     * nodejs-legacy
    Intente: sudo apt-get install &lt;paquete seleccionado&gt;

    usuario@SYTW:~$ nodejs --version
    v0.10.25</code></pre></li>
<li><p>y está instalada una versión vieja de <code>ruby</code>.</p>
<pre><code>        usuario@SYTW:~$ ruby --version
        ruby 1.9.3p484 (2013-11-22 revision 43786) [x86_64-linux]</code></pre></li>
<li><p>Tampoco <code>rvm</code>:</p>
<pre><code>          usuario@SYTW:~$ rvm --version
          No se ha encontrado la orden «rvm» pero hay 20 similares</code></pre></li>
<li><p>No está nada más.</p>
<pre><code>          usuario@SYTW:~$ nvm --version
          No se ha encontrado la orden «nvm»</code></pre></li>
<li><p>Tampoco está <code>npm</code>:</p>
<pre><code>            usuario@SYTW:~$ npm --version
            El programa «npm» no está instalado. Puede instalarlo escribiendo:
            sudo apt-get install npm</code></pre></li>
<li><p>instale <code>npm</code> y si lo desea <code>nvm</code></p></li>
</ul>
<h2 id="acceso-por-ssh-y-credenciales">Acceso por SSH y Credenciales</h2>
<ul>
<li><p>Las credenciales son <code>usuario/usuario</code>, se les forzará a cambiar la contraseña ante el primer login.</p></li>
<li><p>Las máquinas tienen IP dinámica por DHCP (en principio tienen keepalive así que no debería cambiarlas)</p></li>
<li><p>Los usuarios tienen disponibilidad para hacer SSH a las máquinas,</p>
<ol style="list-style-type: decimal">
<li>dentro de la ULL <strong>entrando previamente a <a href="https://acceso.ull.es" class="uri">https://acceso.ull.es</a></strong> y</li>
<li>desde fuera de la ULL usando la VPN</li>
</ol></li>
</ul>
<h3 id="vpn-ull">VPN ULL</h3>
<p>Tutorial sobre como usar el <a href="https://usuarios.ull.es/vpn/">Servicio VPN de la ULL</a></p>
<h2 id="averiguar-la-ip-de-la-máquina-virtual">Averiguar la IP de la máquina virtual</h2>
<ul>
<li><p>Averigue la IP de la máquina para poder usar <code>ssh</code>. En la terminal de su navegador conectado a la máquina escriba:</p>
<pre><code>        usuario@SYTW:~/src/sytw$ ifconfig
        eth0      Link encaa:Ethernet  direcciónHW aa:aa:aa:aa:aa:aa  
                  Direc. inet:55.5.555.55</code></pre></li>
</ul>
<h2 id="instalar-npm">Instalar <code>npm</code></h2>
<ul>
<li><p>Instale <code>npm</code> si no está instalada</p>
<pre><code>      usuario@SYTW:~/src/sytw/express-start/hello$ sudo apt-get install npm</code></pre></li>
</ul>
<p>o mejor aún use <code>nvm</code></p>
<h2 id="configure-el-cliente-ssh-para-trabajar-con-github">Configure el cliente ssh para trabajar con GitHub</h2>
<ul>
<li><p>Recuerde poner sus claves privadas de GitHub en <code>.ssh</code> para poder trabajar con sus repos</p></li>
<li><p>Actualice <code>~/.ssh/config</code> de manera apropiada:</p>
<pre><code>    usuario@SYTW:~/src/sytw$ cat ~/.ssh/config
    Host github.com
    HostName github.com
    user git
    IdentityFile /home/usuario/.ssh/miclaveparagithub</code></pre></li>
</ul>
<h2 id="descargando-un-repo">Descargando un repo</h2>
<ul>
<li><p>Cree un directorio de trabajo:</p>
<pre><code>  usuario@SYTW:~$ mkdir src
  usuario@SYTW:~$ cd src
  usuario@SYTW:~/src$ mkdir sytw
  usuario@SYTW:~/src$ cd sytw/</code></pre></li>
<li><p>Clone un repo con una aplicación Web de prueba. Por ejemplo <a href="https://github.com/crguezl/express-start">crguezl/express-start</a>:</p>
<pre><code>  usuario@SYTW:~/src/sytw$ git clone git@github.com:crguezl/express-start.git
  Clonar en «express-start»...
  Warning: Permanently added the RSA host key for IP address &#39;555.55.555.555&#39;
           to the list of known hosts.
  remote: Counting objects: 87, done.
  remote: Total 87 (delta 0), reused 0 (delta 0), pack-reused 87
  Receiving objects: 100% (87/87), 66.93 KiB | 0 bytes/s, done.
  Resolving deltas: 100% (41/41), done.
  Checking connectivity... hecho.</code></pre></li>
<li><p>Este es el contenido de la aplicación de ejemplo <a href="https://github.com/crguezl/express-start/blob/master/hello/hello.js">hello.js</a>:</p>
<pre><code>    usuario@SYTW:~/src/sytw/express-start$ cd hello/

    usuario@SYTW:~/src/sytw/express-start/hello$ vi hello.js
    usuario@SYTW:~/src/sytw/express-start/hello$ # cambiamos port de escucha a 80

    usuario@SYTW:~/src/sytw/express-start/hello$ cat hello.js</code></pre>
<pre class="sourceCode javascript"><code class="sourceCode javascript">        <span class="kw">var</span> express = <span class="fu">require</span>(<span class="st">&#39;express&#39;</span>)
        <span class="kw">var</span> app = <span class="fu">express</span>()
        <span class="kw">var</span> path = <span class="fu">require</span>(<span class="st">&#39;path&#39;</span>);

        <span class="co">// view engine setup</span>
        <span class="ot">app</span>.<span class="fu">set</span>(<span class="st">&#39;views&#39;</span>, <span class="ot">path</span>.<span class="fu">join</span>(__dirname, <span class="st">&#39;views&#39;</span>));
        <span class="ot">app</span>.<span class="fu">set</span>(<span class="st">&#39;view engine&#39;</span>, <span class="st">&#39;ejs&#39;</span>);

        <span class="ot">app</span>.<span class="fu">get</span>(<span class="st">&#39;/&#39;</span>, <span class="kw">function</span> (req, res) {
          <span class="co">//res.send(&#39;Hello World!&#39;)</span>
          <span class="ot">res</span>.<span class="fu">render</span>(<span class="st">&#39;index&#39;</span>, { <span class="dt">title</span>: <span class="st">&#39;Express&#39;</span> });
        })

        <span class="ot">app</span>.<span class="fu">get</span>(<span class="st">&#39;/chuchu&#39;</span>, <span class="kw">function</span> (req, res) {
          <span class="co">//res.send(&#39;Hello Chuchu!&#39;)</span>
          <span class="ot">res</span>.<span class="fu">render</span>(<span class="st">&#39;index&#39;</span>, { <span class="dt">title</span>: <span class="st">&#39;Chuchu&#39;</span> });
        })

        <span class="kw">var</span> server = <span class="ot">app</span>.<span class="fu">listen</span>(<span class="dv">80</span>, <span class="kw">function</span> () {

          <span class="kw">var</span> host = <span class="ot">server</span>.<span class="fu">address</span>().<span class="fu">address</span>
          <span class="kw">var</span> port = <span class="ot">server</span>.<span class="fu">address</span>().<span class="fu">port</span>

          <span class="ot">console</span>.<span class="fu">log</span>(<span class="st">&#39;Example app listening at http://%s:%s&#39;</span>, host, port)

        })</code></pre></li>
</ul>
<h2 id="instalando-dependencias">Instalando dependencias</h2>
<ul>
<li><p>Instalamos las dependencias:</p>
<pre><code>    usuario@SYTW:~/src/sytw/express-start/hello$ npm install
    npm WARN package.json hello@0.0.0 No description
    npm WARN package.json hello@0.0.0 No repository field.
    ...</code></pre></li>
</ul>
<h2 id="ejecución-de-un-servicio">Ejecución de un servicio</h2>
<ul>
<li><p>Ejecutamos:</p>
<pre><code>    usuario@SYTW:~/src/sytw/express-start/hello$ sudo nodejs hello.js
    sudo: imposible resolver el anfitrión SYTW
    Example app listening at http://0.0.0.0:80</code></pre></li>
<li><p>Visitamos la página con el navegador usando la URL con la IP:</p></li>
</ul>
<div class="figure">
<img src="browser.png" alt="Visitando con el navegador la página" /><p class="caption">Visitando con el navegador la página</p>
</div>
<h2 id="puertos-abiertos-en-las-máquinas-virtuales">Puertos abiertos en las Máquinas Virtuales</h2>
<ul>
<li>Creo que ahora mismo están abiertos los puertos 22, 80, 443 y el rango del 8080 al 8090</li>
</ul>
</body>
</html>
